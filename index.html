<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carbono Quiz ‚Äî Fases ‚öõÔ∏èüåç</title>
  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,.70);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1100px 700px at 12% 8%, rgba(255,80,185,.30), transparent 60%),
        radial-gradient(950px 650px at 90% 15%, rgba(0,255,200,.25), transparent 60%),
        radial-gradient(900px 600px at 30% 95%, rgba(255,210,70,.22), transparent 60%),
        radial-gradient(900px 600px at 95% 85%, rgba(120,90,255,.28), transparent 60%),
        radial-gradient(800px 550px at 55% 55%, rgba(90,200,255,.14), transparent 60%),
        linear-gradient(180deg, #070b14, #0b1220 55%, #070b14);
      overflow-x:hidden;
    }

    .wrap{ max-width: 1020px; margin: 0 auto; padding: 22px 16px 80px; }

    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom: 14px; flex-wrap:wrap;
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width: 260px; }
    .logo{
      width:48px; height:48px; border-radius: 14px;
      background: conic-gradient(from 180deg, #ff4fb7, #ffd24a, #2cffb4, #5aa8ff, #7b5cff, #ff4fb7);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .logo:after{
      content:"‚öõÔ∏è";
      position:absolute; inset:0;
      display:grid; place-items:center; font-size: 22px;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
    }
    h1{ font-size: 20px; margin:0; letter-spacing:.2px; }
    .subtitle{ margin: 2px 0 0; color: var(--muted); font-size: 13px; line-height: 1.25; }

    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12.5px;
      color: var(--muted);
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      white-space:nowrap;
      display:inline-flex; align-items:center; gap:8px;
    }
    .pill strong{ color: var(--text); }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .85fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 920px){ .grid{ grid-template-columns:1fr; } }

    .card{
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .card .head{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:flex-start; justify-content:space-between;
      gap: 10px; flex-wrap:wrap;
    }
    .card .body{ padding: 16px; }

    .row{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; }

    input[type="text"]{
      flex: 1; min-width: 220px;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }

    button{
      cursor:pointer;
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 800;
      color: #071019;
      transform: translateY(0);
      transition: transform .08s ease, filter .15s ease;
      user-select:none;
    }
    button:active{ transform: translateY(1px) scale(.99); }

    .btn-start{
      background: linear-gradient(90deg, #2cffb4, #5aa8ff, #ffd24a, #ff4fb7);
      filter: saturate(1.05) contrast(1.05);
    }
    .btn-secondary{
      color: var(--text);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
    }
    .btn-danger{
      color: var(--text);
      background: rgba(255,79,183,.14);
      border: 1px solid rgba(255,79,183,.24);
    }

    .stats{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .stat{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.15);
      border-radius: 16px;
      padding: 12px;
    }
    .stat .k{ font-size: 12px; color: var(--muted); }
    .stat .v{ font-size: 18px; font-weight: 900; margin-top: 4px; }
    .stat .s{ font-size: 12px; color: var(--muted); margin-top: 6px; line-height:1.25; }

    .progress{
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
    }
    .progress > div{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #ff4fb7, #ffd24a, #2cffb4, #5aa8ff, #7b5cff);
      transition: width .25s ease;
    }
    .progress.sm{ height:10px; }
    .progress.sm > div{ transition: width .2s ease; }

    .qwrap{ margin-top: 10px; }
    .qtitle{ font-size: 18px; font-weight: 900; margin: 0 0 10px; line-height:1.25; }
    .qmeta{ color: var(--muted); font-size: 12.5px; margin: 0 0 12px; }

    .answers{ display:grid; grid-template-columns: 1fr; gap: 10px; }

    .answer{
      text-align:left;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: var(--text);
      box-shadow: 0 12px 28px rgba(0,0,0,.18);
      position:relative;
      overflow:hidden;
    }
    .answer:hover{ filter: brightness(1.06); }
    .answer .tag{ font-size: 12px; opacity: .9; margin-right: 8px; font-weight: 900; }
    .answer:before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.25;
      background: var(--g, linear-gradient(90deg,#5aa8ff,#2cffb4));
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .toast{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: var(--text);
      display:none;
      animation: pop .22s ease both;
      line-height:1.35;
    }
    .toast small{ display:block; color: var(--muted); margin-top:6px; }
    @keyframes pop{
      from{ transform: translateY(6px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }
    .toast.pin{ display:block !important; } /* se clicar, ‚Äúfixa‚Äù */

    .hidden{ display:none !important; }

    .overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal{
      width: min(760px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(10,14,25,.78);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .modal .mhead{
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex; justify-content:space-between; align-items:center;
      gap: 10px; flex-wrap:wrap;
    }
    .modal .mbody{ padding: 16px; text-align:center; }

    .big{ font-size: 30px; font-weight: 1000; margin: 0; line-height:1.1; }
    .msg{ margin: 8px 0 0; color: var(--muted); font-size: 14px; line-height: 1.35; }
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12.5px;
      color: var(--text);
      font-weight: 900;
      margin-top: 10px;
      flex-wrap:wrap;
      justify-content:center;
    }

    #confetti{ position:absolute; inset:0; pointer-events:none; }

    .face{
      font-size: 64px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.45));
      margin: 8px 0 2px;
      animation: wobble 1.1s ease-in-out infinite;
    }
    @keyframes wobble{
      0%,100%{ transform: rotate(-2deg) translateY(0); }
      50%{ transform: rotate(2deg) translateY(-2px); }
    }

    .trophies{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .trophy{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.15);
    }
    .trophy .left{ display:flex; align-items:center; gap:10px; }
    .trophy .emoji{ font-size: 22px; }
    .trophy .name{ font-weight: 900; }
    .trophy .desc{ font-size: 12px; color: var(--muted); margin-top: 2px; line-height:1.2; }
    .trophy.lock{ opacity:.55; filter: grayscale(.1); }
    .trophy .tag{
      font-size: 12px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      white-space:nowrap;
    }

    footer{ margin-top: 14px; color: var(--muted); font-size: 12px; text-align:center; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Carbono Quiz ‚Äî CO‚ÇÇ, CH‚ÇÑ e clima üåç</h1>
          <p class="subtitle">5 fases (cada uma com 5 perguntas), tempo por fase, trof√©us do carbono e tentativa de bater seu pr√≥prio recorde.</p>
        </div>
      </div>

      <div class="row">
        <div class="pill" id="pillPlayer">üë§ <strong>Visitante</strong></div>
        <div class="pill" id="pillPhase">üèÅ Fase <strong>1/5</strong></div>
        <div class="pill" id="pillTimer">‚è±Ô∏è <strong>--:--</strong></div>
      </div>
    </header>

    <div class="grid">
      <!-- ESQUERDA: QUIZ -->
      <section class="card">
        <div class="head">
          <div>
            <div style="font-weight:1000">Jogar em fases</div>
            <div class="subtitle" id="phaseIntro">
              Cada fase aumenta o n√≠vel. Para passar: <strong>70%</strong> ou mais na fase.
            </div>
          </div>
          <div class="row">
            <button class="btn-secondary" id="btnHelp" title="Dica r√°pida">üí° Dica</button>
            <button class="btn-danger" id="btnReset" title="Zerar tudo (nome, trof√©us e recordes)">‚Ü∫ Zerar</button>
          </div>
        </div>

        <div class="body">
          <!-- Tela inicial -->
          <div id="screenStart">
            <div class="row">
              <input id="playerName" type="text" maxlength="22" placeholder="Seu nome (ex: Ernandes, Ana, Jo√£o...)">
              <button class="btn-start" id="btnStart">Come√ßar üöÄ</button>
            </div>
            <div style="margin-top:10px" class="subtitle">
              Dica: as respostas s√£o embaralhadas e n√£o d√° para ‚Äúchutar pelo tamanho‚Äù üòÑ
            </div>

            <div style="margin-top:14px" class="stats">
              <div class="stat">
                <div class="k">Recorde geral (neste aparelho)</div>
                <div class="v" id="bestScore">0%</div>
                <div class="s">Melhor porcentagem somando as 5 fases.</div>
              </div>
              <div class="stat">
                <div class="k">Fase mais alta desbloqueada</div>
                <div class="v" id="bestPhase">1</div>
                <div class="s">Passe as fases com ‚â•70% para subir.</div>
              </div>
            </div>
          </div>

          <!-- Tela do quiz -->
          <div id="screenQuiz" class="hidden">
            <div class="row" style="justify-content:space-between">
              <div class="pill" id="hello">üë§ Jogador</div>
              <div class="pill" id="counter">Pergunta 1/5</div>
            </div>

            <div style="margin-top:12px">
              <div class="subtitle" style="margin-bottom:6px">Progresso da fase</div>
              <div class="progress sm" aria-label="progresso da fase">
                <div id="barPhase"></div>
              </div>
            </div>

            <div style="margin-top:10px">
              <div class="subtitle" style="margin-bottom:6px">Progresso do jogo (5 fases)</div>
              <div class="progress" aria-label="progresso do jogo">
                <div id="barGame"></div>
              </div>
            </div>

            <div class="qwrap">
              <p class="qtitle" id="qTitle">Pergunta</p>
              <p class="qmeta" id="qMeta">Tema</p>

              <div class="answers" id="answers"></div>

              <div class="toast" id="toast" title="Clique para fixar/desfixar o feedback"></div>

              <div class="row" style="margin-top:12px; justify-content:space-between;">
                <button class="btn-secondary" id="btnSkip" title="Pular (sem pontuar)">Pular ‚è≠Ô∏è</button>
                <button class="btn-secondary" id="btnFinish" title="Terminar a fase agora">Finalizar fase ‚úÖ</button>
              </div>

              <div class="subtitle" style="margin-top:10px">
                ‚è±Ô∏è O tempo aparece l√° em cima. Se acabar, voc√™ pode repetir a fase.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- DIREITA: Painel / trof√©us -->
      <aside class="card">
        <div class="head">
          <div>
            <div style="font-weight:1000">Painel do Carbono ‚öõÔ∏è</div>
            <div class="subtitle">Seu nome, score ao vivo e trof√©us por fase.</div>
          </div>
        </div>
        <div class="body">
          <div class="stat" style="margin-bottom:10px;">
            <div class="k">Score da fase</div>
            <div class="v" id="livePhaseScore">0%</div>
            <div class="s" id="livePhaseReq">Precisa de 70% para passar.</div>
          </div>

          <div class="stat" style="margin-bottom:10px;">
            <div class="k">Acertos / Erros (fase)</div>
            <div class="v" id="hits">0 / 0</div>
            <div class="s" id="coach">Carbono √© base da vida ‚Äî o problema √© o excesso de CO‚ÇÇ/CH‚ÇÑ vindo de atividades humanas.</div>
          </div>

          <div class="stat">
            <div class="k">Trof√©us do Carbono</div>
            <div class="trophies" id="trophies"></div>
          </div>

          <div style="margin-top:12px" class="subtitle">
            Quer deixar ainda mais game depois? D√° pra colocar ‚Äúvidas‚Äù, loja de badges, ranking local e modo ‚Äúdesafio rel√¢mpago‚Äù.
          </div>
        </div>
      </aside>
    </div>

    <footer>
      Feito para adolescentes estudarem clima: CO‚ÇÇ, CH‚ÇÑ, ciclo do carbono, qu√≠mica e IPCC. üåøüî•‚ö°
    </footer>
  </div>

  <!-- Modal Resultado -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Resultado">
      <canvas id="confetti"></canvas>
      <div class="mhead">
        <div class="pill" id="finalTag">Resultado</div>
        <button class="btn-secondary" id="btnClose">Fechar ‚úñ</button>
      </div>
      <div class="mbody">
        <div class="face" id="face">üòê</div>
        <p class="big" id="finalTitle">Voc√™ terminou!</p>
        <p class="msg" id="finalMsg">Mensagem</p>
        <div class="badge" id="finalBadge">üèÅ 0%</div>

        <div style="margin-top:14px" class="row" style="justify-content:center">
          <button class="btn-start" id="btnNext">Continuar ‚ñ∂</button>
          <button class="btn-secondary" id="btnRetry">Repetir fase üîÅ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /******************************************************************
     * 0) CONFIG GERAL
     ******************************************************************/
    const PASS_SCORE = 70; // para passar de fase
    const ANSWER_GRADS = [
      "linear-gradient(90deg, rgba(255,79,183,.95), rgba(255,210,74,.95))",
      "linear-gradient(90deg, rgba(44,255,180,.95), rgba(90,168,255,.95))",
      "linear-gradient(90deg, rgba(123,92,255,.95), rgba(255,210,74,.95))",
      "linear-gradient(90deg, rgba(90,168,255,.95), rgba(255,79,183,.95))"
    ];

    const MOTIVATIONS_PASS = [
      "Voc√™ passou! Agora o carbono vai ficar ainda mais interessante (e mais desafiador).",
      "Boa! Entender carbono √© entender energia, vida e clima. Pr√≥xima fase!",
      "Mandou bem ‚Äî agora vem a parte mais ‚ÄúIPCC e mundo real‚Äù.",
      "Vit√≥ria cient√≠fica! Bora subir o n√≠vel."
    ];

    const MOTIVATIONS_FAIL = [
      "N√£o foi hoje ‚Äî mas foi treino de verdade. Repete a fase e melhora 10%!",
      "Errou? Isso √© pista do que estudar. Voc√™ t√° construindo c√©rebro de cientista.",
      "T√° tudo certo: conhecimento nasce de tentativa + ajuste. Bora de novo!",
      "Voc√™ n√£o perdeu: voc√™ coletou dados do que precisa aprender. Repetir!"
    ];

    const COACH_TIPS = [
      "CO‚ÇÇ: sobe com combust√≠veis f√≥sseis e desmatamento; desce com fotoss√≠ntese e oceanos.",
      "CH‚ÇÑ (metano): vem de gado, arrozais, res√≠duos e vazamentos de √≥leo e g√°s.",
      "O efeito estufa √© natural; o aquecimento recente √© a intensifica√ß√£o por emiss√µes humanas.",
      "No ciclo do carbono: atmosfera ‚Üî biosfera ‚Üî oceanos ‚Üî rochas (em escalas de tempo diferentes).",
      "IPCC n√£o faz leis: avalia evid√™ncias e cen√°rios usados por governos e sociedade."
    ];

    // Tempo por fase (segundos). Voc√™ pode ajustar.
    const PHASE_TIME = [90, 80, 70, 65, 60];

    // Trof√©us por fase
    const TROPHIES = [
      { emoji:"ü™ô", name:"Moeda de Carbono", desc:"Voc√™ dominou o b√°sico: CO‚ÇÇ, CH‚ÇÑ e ciclo simples." },
      { emoji:"üçÉ", name:"Folha Fixadora", desc:"Voc√™ entendeu fotoss√≠ntese, sumidouros e fluxos." },
      { emoji:"üî•", name:"Chama do Uso do Solo", desc:"Voc√™ ligou emiss√µes a queimadas, desmatamento e energia." },
      { emoji:"üß™", name:"Liga Qu√≠mica", desc:"Voc√™ encarou liga√ß√µes, estruturas e conceitos mais finos." },
      { emoji:"üõ∞Ô∏è", name:"Selo IPCC", desc:"Voc√™ conectou cen√°rios e evid√™ncias ao mundo real." }
    ];

    /******************************************************************
     * 1) PERGUNTAS ‚Äî 5 fases x 5 perguntas (25)
     * (depois voc√™ pode trocar/expandir, mantendo o formato)
     ******************************************************************/
    const QUESTIONS_BY_PHASE = [
      // FASE 1 ‚Äî bem b√°sica
      [
        { topic:"Qu√≠mica do carbono", q:"O CO‚ÇÇ √© formado por quais √°tomos?", options:["1 carbono + 2 oxig√™nios","2 carbonos + 1 oxig√™nio","1 carbono + 1 oxig√™nio","2 oxig√™nios + 2 carbonos"], a:"1 carbono + 2 oxig√™nios", why:"CO‚ÇÇ = um carbono ligado a dois oxig√™nios." },
        { topic:"Gases de efeito estufa", q:"Qual g√°s √© o principal emitido pela queima de gasolina, diesel e carv√£o?", options:["CO‚ÇÇ","CH‚ÇÑ","O‚ÇÉ","N‚ÇÇ"], a:"CO‚ÇÇ", why:"Queimar combust√≠veis f√≥sseis libera principalmente CO‚ÇÇ." },
        { topic:"Ciclo do carbono", q:"Qual processo remove CO‚ÇÇ do ar e o transforma em mat√©ria org√¢nica?", options:["Fotoss√≠ntese","Evapora√ß√£o","Condensa√ß√£o","Eros√£o"], a:"Fotoss√≠ntese", why:"Plantas e algas usam CO‚ÇÇ para formar a√ß√∫cares." },
        { topic:"Metano", q:"CH‚ÇÑ √© mais conhecido como‚Ä¶", options:["metano","oz√¥nio","nitrog√™nio","arg√¥nio"], a:"metano", why:"CH‚ÇÑ √© metano." },
        { topic:"Clima", q:"O efeito estufa √©‚Ä¶", options:["natural e essencial para manter a Terra habit√°vel","um fen√¥meno que s√≥ existe desde 2000","uma inven√ß√£o do IPCC","algo que n√£o tem rela√ß√£o com gases"], a:"natural e essencial para manter a Terra habit√°vel", why:"O problema √© a intensifica√ß√£o por excesso de gases." }
      ],

      // FASE 2 ‚Äî sumidouros e fontes
      [
        { topic:"Sumidouros", q:"Qual op√ß√£o √© um grande ‚Äúsumidouro‚Äù (absorvedor) de CO‚ÇÇ?", options:["oceanos","est√°tuas de pedra","l√¢mpadas LED","asfalto"], a:"oceanos", why:"Os oceanos absorvem parte do CO‚ÇÇ atmosf√©rico (com efeitos na acidifica√ß√£o)." },
        { topic:"Uso do solo", q:"Desmatamento tende a aumentar CO‚ÇÇ porque‚Ä¶", options:["reduz a fotoss√≠ntese e libera carbono estocado","aumenta a chuva automaticamente","transforma CO‚ÇÇ em oxig√™nio","faz o vento parar"], a:"reduz a fotoss√≠ntese e libera carbono estocado", why:"Menos plantas + queima/decomposi√ß√£o = mais CO‚ÇÇ." },
        { topic:"Metano", q:"Uma fonte comum de CH‚ÇÑ √©‚Ä¶", options:["gado (fermenta√ß√£o ent√©rica)","pain√©is solares","rochas vulc√¢nicas frias","√°rvores fazendo fotoss√≠ntese"], a:"gado (fermenta√ß√£o ent√©rica)", why:"Ruminantes liberam metano durante a digest√£o." },
        { topic:"Carbono na vida", q:"Por que o carbono aparece em tantos seres vivos?", options:["faz liga√ß√µes est√°veis e pode formar muitas mol√©culas diferentes","s√≥ existe na √°gua","n√£o se liga a nada","√© o √∫nico √°tomo do universo"], a:"faz liga√ß√µes est√°veis e pode formar muitas mol√©culas diferentes", why:"Carbono √© √≥timo para construir cadeias e an√©is (qu√≠mica org√¢nica)." },
        { topic:"Compara√ß√£o", q:"Em geral, CH‚ÇÑ no curto prazo √©‚Ä¶ (comparado ao CO‚ÇÇ)", options:["mais potente como g√°s de efeito estufa","igual e sempre dura mais","menos potente e dura s√©culos","sem efeito nenhum"], a:"mais potente como g√°s de efeito estufa", why:"Metano tem forte efeito, mas fica menos tempo que CO‚ÇÇ." }
      ],

      // FASE 3 ‚Äî n√∫meros e fontes grandes/pequenas (sem exigir decorar)
      [
        { topic:"Escalas", q:"Qual setor costuma ser uma grande fonte de CO‚ÇÇ em muitos pa√≠ses?", options:["energia/transportes (queima de combust√≠veis)","pintura de paredes","patina√ß√£o no gelo","chuva"], a:"energia/transportes (queima de combust√≠veis)", why:"Queima de f√≥sseis √© uma das maiores fontes globais de CO‚ÇÇ." },
        { topic:"Biogeoqu√≠mica", q:"Quando mat√©ria org√¢nica apodrece sem oxig√™nio (ambiente an√≥xico), pode gerar mais‚Ä¶", options:["CH‚ÇÑ","He","NaCl","Ar"], a:"CH‚ÇÑ", why:"Decomposi√ß√£o anaer√≥bia pode produzir metano." },
        { topic:"Ciclo do carbono", q:"Qual caminho descreve melhor o ciclo do carbono?", options:["atmosfera ‚Üî plantas ‚Üî solo ‚Üî oceano ‚Üî atmosfera","vento ‚Üí lua ‚Üí oceano ‚Üí Marte","chuva ‚Üí fogo ‚Üí gelo ‚Üí r√°dio","sol ‚Üí pedra ‚Üí televis√£o ‚Üí nuvem"], a:"atmosfera ‚Üî plantas ‚Üî solo ‚Üî oceano ‚Üî atmosfera", why:"O carbono circula entre reservat√≥rios e processos." },
        { topic:"Fontes pequenas", q:"Qual √© uma fonte ‚Äúpequena‚Äù mas real de CO‚ÇÇ na vida di√°ria?", options:["respira√ß√£o humana","um sat√©lite emitindo fuma√ßa","um im√£ parado","uma sombra"], a:"respira√ß√£o humana", why:"Respirar libera CO‚ÇÇ, mas isso faz parte do ciclo natural (n√£o √© a principal causa do aquecimento recente)." },
        { topic:"Mudan√ßa clim√°tica", q:"O aquecimento atual √© ligado principalmente a‚Ä¶", options:["aumento r√°pido de gases de efeito estufa por atividades humanas","mudan√ßa no formato da Terra a cada ano","desaparecimento da gravidade","mais nuvens porque sim"], a:"aumento r√°pido de gases de efeito estufa por atividades humanas", why:"A evid√™ncia aponta para emiss√µes humanas como principal motor recente." }
      ],

      // FASE 4 ‚Äî qu√≠mica e conceitos mais finos
      [
        { topic:"Estrutura", q:"No CO‚ÇÇ, a geometria mais comum da mol√©cula √©‚Ä¶", options:["linear","triangular plana","tetra√©drica","em forma de U"], a:"linear", why:"CO‚ÇÇ √© O=C=O, geralmente linear." },
        { topic:"Liga√ß√µes", q:"O carbono √© especial porque pode‚Ä¶", options:["fazer 4 liga√ß√µes covalentes e formar cadeias","fazer 1 liga√ß√£o s√≥ e nada mais","n√£o se ligar a oxig√™nio","virar metal com calor"], a:"fazer 4 liga√ß√µes covalentes e formar cadeias", why:"Val√™ncia do carbono permite grande diversidade molecular." },
        { topic:"CO‚ÇÇ vs CH‚ÇÑ", q:"Qual afirma√ß√£o faz mais sentido?", options:["CH‚ÇÑ costuma durar menos tempo na atmosfera que CO‚ÇÇ","CH‚ÇÑ √© sempre mais abundante que N‚ÇÇ","CO‚ÇÇ n√£o existe naturalmente","CH‚ÇÑ n√£o tem carbono"], a:"CH‚ÇÑ costuma durar menos tempo na atmosfera que CO‚ÇÇ", why:"Metano tem vida atmosf√©rica menor; CO‚ÇÇ pode persistir por muito tempo." },
        { topic:"Reservat√≥rios", q:"O maior reservat√≥rio de carbono na escala geol√≥gica √©‚Ä¶", options:["rochas/carbonatos e sedimentos","nuvens","pl√°stico","raios"], a:"rochas/carbonatos e sedimentos", why:"H√° muito carbono armazenado em rochas e sedimentos." },
        { topic:"Feedbacks", q:"Um exemplo de ‚Äúfeedback‚Äù clim√°tico √©‚Ä¶", options:["aquecimento derrete gelo e reduz albedo, aumentando aquecimento","chuva apaga o sol permanentemente","vento transforma CO‚ÇÇ em ouro","som alto diminui temperatura global"], a:"aquecimento derrete gelo e reduz albedo, aumentando aquecimento", why:"Menos gelo = mais absor√ß√£o de energia = mais aquecimento." }
      ],

      // FASE 5 ‚Äî IPCC, cen√°rios e linguagem
      [
        { topic:"IPCC", q:"O IPCC faz o qu√™, principalmente?", options:["avalia evid√™ncias cient√≠ficas e sintetiza relat√≥rios","prende quem emite CO‚ÇÇ","vende cr√©ditos de carbono","controla o clima por sat√©lite"], a:"avalia evid√™ncias cient√≠ficas e sintetiza relat√≥rios", why:"O IPCC √© um painel de avalia√ß√£o, n√£o pol√≠cia nem empresa." },
        { topic:"Cen√°rios", q:"Cen√°rios do IPCC (como SSPs) servem para‚Ä¶", options:["explorar futuros poss√≠veis com diferentes emiss√µes e decis√µes","provar que s√≥ existe um futuro","substituir medi√ß√µes reais","acertar a loteria"], a:"explorar futuros poss√≠veis com diferentes emiss√µes e decis√µes", why:"S√£o caminhos plaus√≠veis, usados para proje√ß√µes e planejamento." },
        { topic:"Mitiga√ß√£o", q:"Mitigar mudan√ßa clim√°tica significa‚Ä¶", options:["reduzir emiss√µes e/ou aumentar remo√ß√£o de gases","mudar o nome do carbono","aumentar CH‚ÇÑ para competir com CO‚ÇÇ","apagar o sol"], a:"reduzir emiss√µes e/ou aumentar remo√ß√£o de gases", why:"Mitiga√ß√£o = atacar a causa (emiss√µes/concentra√ß√µes)." },
        { topic:"Adapta√ß√£o", q:"Adapta√ß√£o significa‚Ä¶", options:["ajustar cidades e sistemas para lidar com impactos (calor, cheias, secas)","emitir mais para equilibrar","ignorar o problema","trocar o oxig√™nio do ar"], a:"ajustar cidades e sistemas para lidar com impactos (calor, cheias, secas)", why:"Adapta√ß√£o = lidar com efeitos j√° presentes ou previstos." },
        { topic:"Mensagens-chave", q:"Qual frase √© mais alinhada ao que a ci√™ncia usa como linguagem?", options:["‚ÄòQuanto menos emiss√µes, menor o risco‚Äô","‚ÄòO clima n√£o muda nunca‚Äô","‚ÄòA ci√™ncia j√° decidiu tudo e n√£o mede mais‚Äô","‚ÄòCH‚ÇÑ n√£o tem efeito‚Äô"], a:"‚ÄòQuanto menos emiss√µes, menor o risco‚Äô", why:"Reduzir emiss√µes reduz aquecimento e riscos associados." }
      ]
    ];

    /******************************************************************
     * 2) STORAGE
     ******************************************************************/
    const LS_NAME = "carbonFases_name";
    const LS_UNLOCK = "carbonFases_unlock";      // maior fase desbloqueada (1..5)
    const LS_BEST = "carbonFases_bestOverall";   // melhor score geral (%)
    const LS_TROPH = "carbonFases_trophies";     // array bool [5]
    const LS_LAST = "carbonFases_last";          // estado simples (opcional)

    /******************************************************************
     * 3) UTIL
     ******************************************************************/
    const $ = (id) => document.getElementById(id);

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function formatTime(sec){
      sec = Math.max(0, sec|0);
      const m = String(Math.floor(sec/60)).padStart(2,"0");
      const s = String(sec%60).padStart(2,"0");
      return `${m}:${s}`;
    }

    function randCoach(){
      return COACH_TIPS[Math.floor(Math.random()*COACH_TIPS.length)];
    }

    function phasePct(){
      if(state.answered === 0) return 0;
      return Math.round((state.correct / state.answered) * 100);
    }

    function overallPct(){
      // score geral baseado em todas respondidas at√© agora no jogo (n√£o inclui puladas)
      if(state.totalAnswered === 0) return 0;
      return Math.round((state.totalCorrect / state.totalAnswered) * 100);
    }

    /******************************************************************
     * 4) ESTADO
     ******************************************************************/
    const state = {
      player: "Visitante",
      phase: 1,             // 1..5
      qIndex: 0,            // 0..4
      qList: [],            // 5 perguntas da fase
      correct: 0,
      wrong: 0,
      answered: 0,

      totalCorrect: 0,
      totalAnswered: 0,

      timerSec: 0,
      timerId: null,
      locked: false // trava clique duplo durante feedback
    };

    function loadProfile(){
      const name = localStorage.getItem(LS_NAME);
      if(name) state.player = name;

      const unlock = Number(localStorage.getItem(LS_UNLOCK) || 1);
      const best = Number(localStorage.getItem(LS_BEST) || 0);

      $("playerName").value = state.player !== "Visitante" ? state.player : "";
      $("bestScore").textContent = best + "%";
      $("bestPhase").textContent = unlock;

      renderTrophies();
      setPlayerUI();
    }

    function saveProfile(){
      localStorage.setItem(LS_NAME, state.player);
    }

    function getUnlock(){
      return clamp(Number(localStorage.getItem(LS_UNLOCK) || 1), 1, 5);
    }

    function setUnlock(n){
      localStorage.setItem(LS_UNLOCK, String(clamp(n,1,5)));
      $("bestPhase").textContent = getUnlock();
    }

    function getTrophyFlags(){
      try{
        const raw = localStorage.getItem(LS_TROPH);
        if(!raw) return [false,false,false,false,false];
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr) || arr.length !== 5) return [false,false,false,false,false];
        return arr.map(Boolean);
      }catch{
        return [false,false,false,false,false];
      }
    }

    function setTrophy(phase){
      const flags = getTrophyFlags();
      flags[phase-1] = true;
      localStorage.setItem(LS_TROPH, JSON.stringify(flags));
      renderTrophies();
    }

    function renderTrophies(){
      const flags = getTrophyFlags();
      const unlock = getUnlock();
      const box = $("trophies");
      box.innerHTML = "";

      TROPHIES.forEach((t, i) => {
        const phase = i+1;
        const got = flags[i];
        const locked = phase > unlock;

        const div = document.createElement("div");
        div.className = "trophy" + (locked ? " lock" : "");
        const left = document.createElement("div");
        left.className = "left";

        const em = document.createElement("div");
        em.className = "emoji";
        em.textContent = t.emoji;

        const meta = document.createElement("div");
        meta.innerHTML = `<div class="name">Fase ${phase}: ${t.name}</div><div class="desc">${t.desc}</div>`;

        left.appendChild(em);
        left.appendChild(meta);

        const tag = document.createElement("div");
        tag.className = "tag";
        if(locked) tag.textContent = "üîí bloqueado";
        else tag.textContent = got ? "üèÜ ganho" : "‚è≥ pendente";

        div.appendChild(left);
        div.appendChild(tag);
        box.appendChild(div);
      });
    }

    function setPlayerUI(){
      $("pillPlayer").innerHTML = `üë§ <strong>${escapeHtml(state.player)}</strong>`;
      $("hello").textContent = `üë§ ${state.player}`;
    }

    function setPhaseUI(){
      $("pillPhase").innerHTML = `üèÅ Fase <strong>${state.phase}/5</strong>`;
      const intro = `Fase ${state.phase}: ${TROPHIES[state.phase-1].emoji} <strong>${TROPHIES[state.phase-1].name}</strong> ‚Äî passe com <strong>${PASS_SCORE}%</strong> ou mais.`;
      $("phaseIntro").innerHTML = intro;
    }

    function setTimerUI(){
      $("pillTimer").innerHTML = `‚è±Ô∏è <strong>${formatTime(state.timerSec)}</strong>`;
    }

    function setCoachText(text){
      $("coach").textContent = text;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    /******************************************************************
     * 5) JOGO ‚Äî FASE
     ******************************************************************/
    function startGame(){
      const raw = $("playerName").value.trim();
      state.player = raw ? raw : "Visitante";
      saveProfile();
      setPlayerUI();

      // reset geral do jogo (mas sem apagar trof√©us/recorde do storage)
      state.phase = 1;
      state.totalCorrect = 0;
      state.totalAnswered = 0;

      $("screenStart").classList.add("hidden");
      $("screenQuiz").classList.remove("hidden");

      startPhase(1, { enforceUnlock:false });
    }

    function startPhase(phase, opts = { enforceUnlock:true }){
      const unlock = getUnlock();
      if(opts.enforceUnlock && phase > unlock){
        // se tentar pular fase, cai na maior desbloqueada
        phase = unlock;
      }

      state.phase = phase;
      state.qIndex = 0;
      state.correct = 0;
      state.wrong = 0;
      state.answered = 0;
      state.locked = false;

      // perguntas da fase (embaralha a ordem, mas mant√©m 5)
      state.qList = shuffle(QUESTIONS_BY_PHASE[phase-1]);

      // timer por fase
      stopTimer();
      state.timerSec = PHASE_TIME[phase-1];
      setTimerUI();
      state.timerId = setInterval(tickTimer, 1000);

      setPhaseUI();
      setCoachText(randCoach());

      // barras
      updateHUD();
      renderQuestion();
    }

    function stopTimer(){
      if(state.timerId){
        clearInterval(state.timerId);
        state.timerId = null;
      }
    }

    function tickTimer(){
      state.timerSec--;
      setTimerUI();

      if(state.timerSec <= 0){
        stopTimer();
        // tempo acabou: finaliza como falha da fase
        finishPhase({ reason:"time" });
      }
    }

    function updateHUD(){
      // fase
      $("counter").textContent = `Pergunta ${state.qIndex+1}/5`;
      $("hits").textContent = `${state.correct} / ${state.wrong}`;
      $("livePhaseScore").textContent = phasePct() + "%";
      $("livePhaseReq").textContent = `Precisa de ${PASS_SCORE}% para passar.`;

      const phaseProgress = Math.round((state.qIndex / 5) * 100);
      $("barPhase").style.width = phaseProgress + "%";

      // jogo (0..25)
      const gameProgress = Math.round((((state.phase-1)*5 + state.qIndex) / 25) * 100);
      $("barGame").style.width = gameProgress + "%";

      setPhaseUI();
      setTimerUI();
    }

    function showToast(ok, title, why){
      const t = $("toast");
      t.classList.remove("pin");
      t.style.display = "block";
      t.style.borderColor = ok ? "rgba(44,255,180,.35)" : "rgba(255,79,183,.35)";
      t.style.background = ok ? "rgba(44,255,180,.10)" : "rgba(255,79,183,.10)";
      t.innerHTML = `${title}<small>${escapeHtml(why || "")}</small>`;

      // MAIS TEMPO para ler (antes era curto)
      // e se clicar no toast, ele ‚Äúfixa‚Äù para voc√™ ler com calma
      clearTimeout(showToast._to);
      showToast._to = setTimeout(()=>{ if(!t.classList.contains("pin")) t.style.display="none"; }, 4200);
    }

    $("toast").addEventListener("click", () => {
      const t = $("toast");
      if(t.style.display !== "block") return;
      t.classList.toggle("pin");
    });

    function renderQuestion(){
      const item = state.qList[state.qIndex];
      $("qTitle").textContent = item.q;
      $("qMeta").textContent = `Tema: ${item.topic} ‚Ä¢ Fase ${state.phase}`;

      const opts = shuffle(item.options);
      const box = $("answers");
      box.innerHTML = "";

      opts.forEach((opt, i) => {
        const b = document.createElement("button");
        b.className = "answer";
        b.style.setProperty("--g", ANSWER_GRADS[i % ANSWER_GRADS.length]);
        b.innerHTML = `<span class="tag">${String.fromCharCode(65+i)})</span>${escapeHtml(opt)}`;
        b.onclick = () => answer(opt);
        box.appendChild(b);
      });

      updateHUD();
    }

    function answer(chosen){
      if(state.locked) return;
      state.locked = true;

      const item = state.qList[state.qIndex];
      const ok = chosen === item.a;

      state.answered++;
      state.totalAnswered++;

      if(ok){
        state.correct++;
        state.totalCorrect++;
        showToast(true, "‚úÖ Boa! ", item.why);
      }else{
        state.wrong++;
        showToast(false, "‚ùå Quase! ", item.why);
      }

      setCoachText(randCoach());

      // avan√ßa ap√≥s um ‚Äúpulso‚Äù curto (mas sem sumir o feedback r√°pido demais)
      setTimeout(() => {
        state.locked = false;
        state.qIndex++;

        if(state.qIndex >= 5){
          stopTimer();
          finishPhase({ reason:"done" });
        }else{
          document.body.animate(
            [{ filter:"brightness(1)" }, { filter:"brightness(1.06)" }, { filter:"brightness(1)" }],
            { duration: 240, easing:"ease-out" }
          );
          renderQuestion();
        }
      }, 450);

      updateHUD();
    }

    function skip(){
      if(state.locked) return;
      state.qIndex++;
      if(state.qIndex >= 5){
        stopTimer();
        finishPhase({ reason:"skipEnd" });
      }else{
        renderQuestion();
      }
    }

    function finishPhase({ reason }){
      // fecha toast (se n√£o estiver fixo)
      const t = $("toast");
      if(!t.classList.contains("pin")) t.style.display = "none";

      // barras
      $("barPhase").style.width = "100%";
      const gameProgress = Math.round((((state.phase-1)*5 + 5) / 25) * 100);
      $("barGame").style.width = gameProgress + "%";

      const score = phasePct();
      const passed = score >= PASS_SCORE && reason !== "time";

      // desbloqueio + trof√©u
      const unlock = getUnlock();
      if(passed){
        setTrophy(state.phase);
        if(state.phase === unlock && unlock < 5){
          setUnlock(unlock + 1);
        }
      }

      // recorde geral (somente quando termina a fase 5 com jogo completo) ‚Äî simples:
      // aqui eu atualizo ‚ÄúbestOverall‚Äù sempre que voc√™ fecha uma fase, usando a m√©dia do progresso atual do jogo.
      const overall = overallPct();
      const best = Number(localStorage.getItem(LS_BEST) || 0);
      if(overall > best){
        localStorage.setItem(LS_BEST, String(overall));
        $("bestScore").textContent = overall + "%";
      }

      // modal
      showResultModal({ score, passed, reason, overall });
    }

    /******************************************************************
     * 6) MODAL + CONFETTI
     ******************************************************************/
    const conf = { running:false, t0:0, duration:0, parts:[] };

    function startConfetti(ms){
      const c = $("confetti");
      const ctx = c.getContext("2d");
      const modal = c.parentElement;

      function resize(){
        c.width = modal.clientWidth * devicePixelRatio;
        c.height = modal.clientHeight * devicePixelRatio;
      }
      resize();
      window.addEventListener("resize", resize, { passive:true });

      conf.running = true;
      conf.t0 = performance.now();
      conf.duration = ms || 900;
      conf.parts = Array.from({length: 140}, () => ({
        x: Math.random()*c.width,
        y: -Math.random()*c.height*0.25,
        r: 2 + Math.random()*4,
        vy: 2 + Math.random()*6,
        vx: -2 + Math.random()*4,
        a: Math.random()*Math.PI*2,
        va: -0.15 + Math.random()*0.3
      }));

      (function tick(t){
        if(!conf.running) return;
        const elapsed = t - conf.t0;
        ctx.clearRect(0,0,c.width,c.height);

        conf.parts.forEach((p, i) => {
          p.x += p.vx;
          p.y += p.vy;
          p.a += p.va;

          const hue = (i*7 + elapsed*0.08) % 360;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.a);
          ctx.fillStyle = `hsla(${hue}, 95%, 65%, .95)`;
          ctx.fillRect(-p.r, -p.r, p.r*2.2, p.r*1.6);
          ctx.restore();

          if(p.y > c.height + 20){
            p.y = -20;
            p.x = Math.random()*c.width;
          }
        });

        if(elapsed < conf.duration){
          requestAnimationFrame(tick);
        }else{
          setTimeout(stopConfetti, 220);
        }
      })(performance.now());
    }

    function stopConfetti(){
      conf.running = false;
      const c = $("confetti");
      const ctx = c.getContext("2d");
      ctx.clearRect(0,0,c.width,c.height);
    }

    function showResultModal({ score, passed, reason, overall }){
      $("overlay").style.display = "flex";

      let face = "üòê";
      let title = `${state.player}, fase ${state.phase} conclu√≠da!`;
      let msg = "";
      let tag = "";

      if(reason === "time"){
        face = "üòñ";
        title = `‚è±Ô∏è Tempo acabou, ${state.player}!`;
        msg = MOTIVATIONS_FAIL[Math.floor(Math.random()*MOTIVATIONS_FAIL.length)];
        tag = "Treino do Carbono üí™";
        stopConfetti();
      }else if(passed){
        if(score === 100){
          face = "ü§©";
          title = `Perfeito! 100% na fase ${state.phase}!`;
          msg = "Voc√™ ganhou o trof√©u da fase. Bora subir! üöÄ";
          tag = "Festa do Carbono üéâ";
          startConfetti(1200);
        }else{
          face = "ü•≥";
          title = `Voc√™ passou a fase ${state.phase}!`;
          msg = MOTIVATIONS_PASS[Math.floor(Math.random()*MOTIVATIONS_PASS.length)];
          tag = "Subindo de n√≠vel ‚¨ÜÔ∏è";
          startConfetti(800);
        }
      }else{
        face = score >= 40 ? "üôÇ" : "üòñ";
        title = `Ainda n√£o passou a fase ${state.phase}`;
        msg = MOTIVATIONS_FAIL[Math.floor(Math.random()*MOTIVATIONS_FAIL.length)];
        tag = "Treino do Carbono üí™";
        stopConfetti();
      }

      const trophy = TROPHIES[state.phase-1];
      const phaseLine = `Fase ${state.phase}: ${score}% ‚Ä¢ Acertos: ${state.correct} ‚Ä¢ Erros: ${state.wrong}`;
      const overallLine = `Geral (nesta rodada): ${overall}%`;

      $("finalTag").textContent = tag;
      $("face").textContent = face;
      $("finalTitle").textContent = title;
      $("finalMsg").textContent = msg;

      const got = getTrophyFlags()[state.phase-1];
      const trophyTxt = got ? `üèÜ Trof√©u: ${trophy.emoji} ${trophy.name}` : `üéØ Trof√©u pendente: ${trophy.emoji} ${trophy.name}`;

      $("finalBadge").textContent = "";
      $("finalBadge").innerHTML = `${escapeHtml(phaseLine)} ‚Ä¢ ${escapeHtml(overallLine)} ‚Ä¢ ${escapeHtml(trophyTxt)}`;

      // Bot√£o continuar: s√≥ segue se passou
      $("btnNext").disabled = !passed;
      $("btnNext").style.filter = passed ? "none" : "grayscale(1) opacity(.6)";
    }

    function closeModal(){
      $("overlay").style.display = "none";
      stopConfetti();
    }

    function nextStep(){
      // se passou, vai pr√≥xima fase (se existir) ou encerra
      const score = phasePct();
      const passed = score >= PASS_SCORE;

      if(!passed) return;

      if(state.phase < 5){
        closeModal();
        startPhase(state.phase + 1, { enforceUnlock:true });
      }else{
        // fim do jogo
        closeModal();
        $("screenQuiz").classList.add("hidden");
        $("screenStart").classList.remove("hidden");
        loadProfile();
      }
    }

    function retryPhase(){
      closeModal();
      startPhase(state.phase, { enforceUnlock:true });
    }

    /******************************************************************
     * 7) A√á√ïES
     ******************************************************************/
    function showHelp(){
      const tip = randCoach();
      const t = $("toast");
      t.classList.add("pin");
      t.style.display = "block";
      t.style.borderColor = "rgba(90,168,255,.35)";
      t.style.background = "rgba(90,168,255,.10)";
      t.innerHTML = `üí° Dica r√°pida<small>${escapeHtml(tip)}</small>`;
      // fica fixo; clique para desfixar
    }

    function hardReset(){
      stopTimer();
      stopConfetti();
      localStorage.removeItem(LS_NAME);
      localStorage.removeItem(LS_UNLOCK);
      localStorage.removeItem(LS_BEST);
      localStorage.removeItem(LS_TROPH);
      state.player = "Visitante";
      $("playerName").value = "";
      $("screenQuiz").classList.add("hidden");
      $("screenStart").classList.remove("hidden");
      $("toast").style.display = "none";
      $("barGame").style.width = "0%";
      $("barPhase").style.width = "0%";
      $("pillTimer").innerHTML = `‚è±Ô∏è <strong>--:--</strong>`;
      loadProfile();
      setCoachText("Zerou tudo. Agora √© a sua chance de construir a trajet√≥ria: fase por fase. üí™");
    }

    /******************************************************************
     * 8) EVENTOS
     ******************************************************************/
    $("btnStart").addEventListener("click", startGame);
    $("playerName").addEventListener("keydown", (e)=>{ if(e.key==="Enter") startGame(); });

    $("btnSkip").addEventListener("click", skip);
    $("btnFinish").addEventListener("click", ()=>{ stopTimer(); finishPhase({ reason:"manual" }); });

    $("btnHelp").addEventListener("click", showHelp);
    $("btnReset").addEventListener("click", hardReset);

    $("btnClose").addEventListener("click", closeModal);
    $("btnNext").addEventListener("click", nextStep);
    $("btnRetry").addEventListener("click", retryPhase);

    // inicializa
    loadProfile();
  </script>
</body>
</html>
