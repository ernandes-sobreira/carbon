<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carbono Quiz ‚öõÔ∏èüåç</title>
  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,.70);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
    }

    /* Fundo bem colorido (sem paleta crescente/decrescente) */
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1100px 700px at 12% 8%, rgba(255,80,185,.30), transparent 60%),
        radial-gradient(950px 650px at 90% 15%, rgba(0,255,200,.25), transparent 60%),
        radial-gradient(900px 600px at 30% 95%, rgba(255,210,70,.22), transparent 60%),
        radial-gradient(900px 600px at 95% 85%, rgba(120,90,255,.28), transparent 60%),
        radial-gradient(800px 550px at 55% 55%, rgba(90,200,255,.14), transparent 60%),
        linear-gradient(180deg, #070b14, #0b1220 55%, #070b14);
      overflow-x:hidden;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 22px 16px 80px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo{
      width:48px; height:48px;
      border-radius: 14px;
      background:
        conic-gradient(from 180deg, #ff4fb7, #ffd24a, #2cffb4, #5aa8ff, #7b5cff, #ff4fb7);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .logo:after{
      content:"‚öõÔ∏è";
      position:absolute; inset:0;
      display:grid; place-items:center;
      font-size: 22px;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
    }

    h1{
      font-size: 20px;
      margin:0;
      letter-spacing:.2px;
    }
    .subtitle{
      margin: 2px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.25;
    }

    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12.5px;
      color: var(--muted);
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 880px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .card .head{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .card .body{
      padding: 16px;
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }

    input[type="text"]{
      flex: 1;
      min-width: 220px;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }

    button{
      cursor:pointer;
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 700;
      color: #071019;
      transform: translateY(0);
      transition: transform .08s ease, filter .15s ease;
      user-select:none;
    }
    button:active{ transform: translateY(1px) scale(.99); }

    .btn-start{
      background: linear-gradient(90deg, #2cffb4, #5aa8ff, #ffd24a, #ff4fb7);
      filter: saturate(1.05) contrast(1.05);
    }
    .btn-secondary{
      color: var(--text);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .stat{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.15);
      border-radius: 16px;
      padding: 12px;
    }
    .stat .k{
      font-size: 12px;
      color: var(--muted);
    }
    .stat .v{
      font-size: 18px;
      font-weight: 800;
      margin-top: 4px;
    }

    .progress{
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
    }
    .progress > div{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #ff4fb7, #ffd24a, #2cffb4, #5aa8ff, #7b5cff);
      transition: width .25s ease;
    }

    .qwrap{ margin-top: 10px; }
    .qtitle{
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 10px;
      line-height:1.25;
    }
    .qmeta{
      color: var(--muted);
      font-size: 12.5px;
      margin: 0 0 12px;
    }

    .answers{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    /* Cada alternativa com cor diferente */
    .answer{
      text-align:left;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: var(--text);
      box-shadow: 0 12px 28px rgba(0,0,0,.18);
      position:relative;
      overflow:hidden;
    }
    .answer:hover{ filter: brightness(1.06); }
    .answer .tag{
      font-size: 12px;
      opacity: .9;
      margin-right: 8px;
      font-weight: 800;
    }
    .answer:before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.25;
      background: var(--g, linear-gradient(90deg,#5aa8ff,#2cffb4));
      pointer-events:none;
      mix-blend-mode: screen;
    }

    /* Feedback */
    .toast{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: var(--text);
      display:none;
      animation: pop .22s ease both;
    }
    @keyframes pop{
      from{ transform: translateY(6px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }

    .hidden{ display:none !important; }

    /* Modal resultado */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal{
      width: min(720px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(10,14,25,.78);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .modal .mhead{
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
    }
    .modal .mbody{
      padding: 16px;
    }
    .big{
      font-size: 30px;
      font-weight: 900;
      margin: 0;
      line-height:1.1;
    }
    .msg{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12.5px;
      color: var(--text);
      font-weight: 800;
      margin-top: 10px;
    }

    /* Confete (canvas por cima do modal) */
    #confetti{
      position:absolute;
      inset:0;
      pointer-events:none;
    }

    /* Carinha ‚Äúfeia mas otimista‚Äù */
    .face{
      font-size: 64px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.45));
      margin: 8px 0 2px;
      animation: wobble 1.1s ease-in-out infinite;
    }
    @keyframes wobble{
      0%,100%{ transform: rotate(-2deg) translateY(0); }
      50%{ transform: rotate(2deg) translateY(-2px); }
    }

    footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }
    a{ color: #a6ffea; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Carbono Quiz ‚Äî CO‚ÇÇ, CH‚ÇÑ e clima üåç</h1>
          <p class="subtitle">Um quiz para adolescentes: ciclo do carbono, qu√≠mica b√°sica, fontes de emiss√£o e IPCC. Jogue e tente bater seu pr√≥prio recorde.</p>
        </div>
      </div>
      <div class="pill" id="pillInfo">‚ö° Modo: treine & suba o score</div>
    </header>

    <div class="grid">
      <!-- ESQUERDA: QUIZ -->
      <section class="card">
        <div class="head">
          <div>
            <div style="font-weight:900">Jogar</div>
            <div class="subtitle">Carbono √© ‚Äúvida‚Äù, ‚Äúenergia‚Äù e tamb√©m o principal motor do aquecimento atual quando vira CO‚ÇÇ/CH‚ÇÑ em excesso.</div>
          </div>
          <button class="btn-secondary" id="btnReset" title="Zerar sess√£o">‚Ü∫ Reiniciar</button>
        </div>

        <div class="body">
          <!-- Tela inicial -->
          <div id="screenStart">
            <div class="row">
              <input id="playerName" type="text" maxlength="22" placeholder="Seu nome (ex: Ana, Jo√£o, ...)">
              <button class="btn-start" id="btnStart">Come√ßar üöÄ</button>
            </div>
            <div style="margin-top:10px" class="subtitle">
              Dica: as respostas s√£o embaralhadas e as alternativas n√£o seguem ‚Äútamanho de texto‚Äù. üòÑ
            </div>

            <div style="margin-top:14px" class="stats">
              <div class="stat">
                <div class="k">Seu recorde (neste aparelho)</div>
                <div class="v" id="bestScore">0%</div>
              </div>
              <div class="stat">
                <div class="k">Tentativas</div>
                <div class="v" id="tries">0</div>
              </div>
            </div>
          </div>

          <!-- Tela do quiz -->
          <div id="screenQuiz" class="hidden">
            <div class="row" style="justify-content:space-between">
              <div class="pill" id="hello">üë§ Jogador</div>
              <div class="pill" id="counter">Pergunta 1/1</div>
            </div>

            <div style="margin-top:12px" class="progress" aria-label="progresso">
              <div id="bar"></div>
            </div>

            <div class="qwrap">
              <p class="qtitle" id="qTitle">Pergunta</p>
              <p class="qmeta" id="qMeta">Tema</p>

              <div class="answers" id="answers"></div>

              <div class="toast" id="toast"></div>

              <div class="row" style="margin-top:12px; justify-content:space-between;">
                <button class="btn-secondary" id="btnSkip" title="Pular (sem pontuar)">Pular ‚è≠Ô∏è</button>
                <button class="btn-secondary" id="btnFinish" title="Terminar agora">Finalizar ‚úÖ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- DIREITA: Painel / refor√ßo -->
      <aside class="card">
        <div class="head">
          <div>
            <div style="font-weight:900">Painel do Carbono ‚öõÔ∏è</div>
            <div class="subtitle">Mini lembretes para aprender jogando.</div>
          </div>
        </div>
        <div class="body">
          <div class="stat" style="margin-bottom:10px;">
            <div class="k">Score atual</div>
            <div class="v" id="liveScore">0%</div>
          </div>

          <div class="stat" style="margin-bottom:10px;">
            <div class="k">Acertos / Erros</div>
            <div class="v" id="hits">0 / 0</div>
          </div>

          <div class="stat">
            <div class="k">Mensagem r√°pida</div>
            <div class="v" style="font-size:14px; font-weight:700; line-height:1.35" id="coach">
              Carbono n√£o √© vil√£o por si s√≥: o problema √© o excesso de CO‚ÇÇ/CH‚ÇÑ vindo de combust√≠veis f√≥sseis, desmatamento e mudan√ßas no uso do solo.
            </div>
          </div>

          <div style="margin-top:12px" class="subtitle">
            Quer deixar mais ‚Äúgame‚Äù? Depois a gente coloca: cron√¥metro, fases, n√≠vel f√°cil/m√©dio/dif√≠cil e ‚Äúcartas‚Äù de dicas do IPCC.
          </div>
        </div>
      </aside>
    </div>

    <footer>
      Feito para estudar clima: CO‚ÇÇ, CH‚ÇÑ, ciclo do carbono, qu√≠mica e IPCC. üåøüî•‚ö°
    </footer>
  </div>

  <!-- Modal Resultado -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Resultado do quiz">
      <canvas id="confetti"></canvas>
      <div class="mhead">
        <div class="pill" id="finalTag">Resultado</div>
        <button class="btn-secondary" id="btnClose">Fechar ‚úñ</button>
      </div>
      <div class="mbody" style="text-align:center">
        <div class="face" id="face">üòê</div>
        <p class="big" id="finalTitle">Voc√™ terminou!</p>
        <p class="msg" id="finalMsg">Mensagem</p>
        <div class="badge" id="finalBadge">üèÅ 0%</div>

        <div style="margin-top:14px" class="row" style="justify-content:center">
          <button class="btn-start" id="btnPlayAgain">Jogar de novo (bater recorde) üéÆ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /******************************************************************
     * 1) COLOQUE AS PERGUNTAS AQUI (depois a gente aumenta o pacot√£o)
     * - Cada quest√£o: { topic, q, options:[...], a: "resposta exata", why:"explica√ß√£o curta" }
     ******************************************************************/
    const QUESTION_PACK = [
      {
        topic: "Qu√≠mica do carbono",
        q: "O CO‚ÇÇ √© formado por quais √°tomos?",
        options: ["1 carbono + 2 oxig√™nios", "2 carbonos + 1 oxig√™nio", "1 carbono + 1 oxig√™nio", "2 oxig√™nios + 2 carbonos"],
        a: "1 carbono + 2 oxig√™nios",
        why: "CO‚ÇÇ = um √°tomo de carbono ligado a dois de oxig√™nio."
      },
      {
        topic: "Gases de efeito estufa",
        q: "Qual g√°s √© o principal emitido pela queima de gasolina, diesel e carv√£o?",
        options: ["CO‚ÇÇ", "CH‚ÇÑ", "O‚ÇÉ", "N‚ÇÇ"],
        a: "CO‚ÇÇ",
        why: "Combust√≠veis f√≥sseis, quando queimados, liberam principalmente CO‚ÇÇ."
      },
      {
        topic: "Ciclo do carbono",
        q: "Qual processo remove CO‚ÇÇ da atmosfera e o transforma em mat√©ria org√¢nica?",
        options: ["Fotoss√≠ntese", "Evapora√ß√£o", "Eros√£o", "Condensa√ß√£o"],
        a: "Fotoss√≠ntese",
        why: "Plantas e algas usam CO‚ÇÇ + √°gua + luz para formar a√ß√∫cares."
      },
      {
        topic: "IPCC",
        q: "O IPCC √©‚Ä¶",
        options: [
          "um painel cient√≠fico que avalia evid√™ncias sobre clima",
          "uma empresa que mede CO‚ÇÇ em sat√©lites",
          "um tratado que obriga pa√≠ses a zerar emiss√µes",
          "um laborat√≥rio que inventou o efeito estufa"
        ],
        a: "um painel cient√≠fico que avalia evid√™ncias sobre clima",
        why: "O IPCC re√∫ne cientistas e publica relat√≥rios de avalia√ß√£o (n√£o √© √≥rg√£o de fiscaliza√ß√£o)."
      }
    ];

    /******************************************************************
     * 2) CONFIG / FRASES / EMOJIS
     ******************************************************************/
    const MOTIVATIONS = [
      "Carbono √© a base da vida ‚Äî entender o ciclo √© entender o planeta.",
      "Voc√™ n√£o precisa acertar tudo: precisa aprender um pouco a cada rodada.",
      "Clima √© ci√™ncia + escolhas. Seu conhecimento vira a√ß√£o.",
      "CO‚ÇÇ e CH‚ÇÑ s√£o naturais‚Ä¶ o problema √© o excesso vindo das nossas atividades.",
      "Errou? √ìtimo. Agora voc√™ sabe exatamente o que estudar."
    ];

    const COACH_TIPS = [
      "CO‚ÇÇ: sobe com combust√≠veis f√≥sseis e desmatamento; desce com fotoss√≠ntese e oceanos.",
      "CH‚ÇÑ (metano): vem de gado, arrozais, res√≠duos e vazamentos de √≥leo e g√°s.",
      "O efeito estufa √© natural, mas a intensifica√ß√£o recente √© causada por emiss√µes humanas.",
      "No ciclo do carbono: atmosfera ‚Üî biosfera ‚Üî oceanos ‚Üî rochas (em escalas diferentes).",
      "Cen√°rios do IPCC simulam futuros poss√≠veis com diferentes emiss√µes e pol√≠ticas."
    ];

    // Gradientes aleat√≥rios por alternativa (bem colorido)
    const ANSWER_GRADS = [
      "linear-gradient(90deg, rgba(255,79,183,.95), rgba(255,210,74,.95))",
      "linear-gradient(90deg, rgba(44,255,180,.95), rgba(90,168,255,.95))",
      "linear-gradient(90deg, rgba(123,92,255,.95), rgba(255,210,74,.95))",
      "linear-gradient(90deg, rgba(90,168,255,.95), rgba(255,79,183,.95))"
    ];

    /******************************************************************
     * 3) ESTADO
     ******************************************************************/
    const $ = (id) => document.getElementById(id);

    let player = "Visitante";
    let qList = [];
    let idx = 0;
    let correct = 0;
    let wrong = 0;
    let answered = 0;

    const LS_BEST = "carbonQuiz_best";
    const LS_TRIES = "carbonQuiz_tries";

    function loadStats(){
      const best = Number(localStorage.getItem(LS_BEST) || 0);
      const tries = Number(localStorage.getItem(LS_TRIES) || 0);
      $("bestScore").textContent = best + "%";
      $("tries").textContent = tries;
    }

    function saveTry(){
      const tries = Number(localStorage.getItem(LS_TRIES) || 0) + 1;
      localStorage.setItem(LS_TRIES, String(tries));
      $("tries").textContent = tries;
    }

    function setCoachText(text){
      $("coach").textContent = text;
    }

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function pct(){
      if(answered === 0) return 0;
      return Math.round((correct / answered) * 100);
    }

    function updateHUD(){
      $("liveScore").textContent = pct() + "%";
      $("hits").textContent = `${correct} / ${wrong}`;
      $("counter").textContent = `Pergunta ${idx+1}/${qList.length}`;
      $("bar").style.width = `${Math.round(((idx)/qList.length)*100)}%`;
    }

    function showToast(ok, text){
      const t = $("toast");
      t.style.display = "block";
      t.textContent = text;
      t.style.borderColor = ok ? "rgba(44,255,180,.35)" : "rgba(255,79,183,.35)";
      t.style.background = ok ? "rgba(44,255,180,.10)" : "rgba(255,79,183,.10)";
      setTimeout(()=>{ t.style.display="none"; }, 1200);
    }

    function renderQuestion(){
      const item = qList[idx];
      $("qTitle").textContent = item.q;
      $("qMeta").textContent = `Tema: ${item.topic}`;

      // dica din√¢mica
      setCoachText(COACH_TIPS[Math.floor(Math.random()*COACH_TIPS.length)]);

      const opts = shuffle(item.options);
      const box = $("answers");
      box.innerHTML = "";

      opts.forEach((opt, i) => {
        const b = document.createElement("button");
        b.className = "answer";
        b.style.setProperty("--g", ANSWER_GRADS[i % ANSWER_GRADS.length]);
        b.innerHTML = `<span class="tag">${String.fromCharCode(65+i)})</span>${opt}`;
        b.onclick = () => answer(opt);
        box.appendChild(b);
      });

      updateHUD();
    }

    function answer(chosen){
      const item = qList[idx];
      const ok = chosen === item.a;

      answered++;
      if(ok) correct++; else wrong++;

      // feedback r√°pido
      if(ok){
        showToast(true, "‚úÖ Boa! " + item.why);
      }else{
        showToast(false, "‚ùå Quase! " + item.why);
      }

      // avan√ßa
      idx++;
      if(idx >= qList.length){
        finish();
      }else{
        // mini anima√ß√£o de ‚Äúpassar p√°gina‚Äù
        document.body.animate(
          [{ filter:"brightness(1)" }, { filter:"brightness(1.06)" }, { filter:"brightness(1)" }],
          { duration: 240, easing:"ease-out" }
        );
        renderQuestion();
      }
    }

    function skip(){
      idx++;
      if(idx >= qList.length) finish();
      else renderQuestion();
    }

    function finish(){
      // barra 100%
      $("bar").style.width = "100%";

      const score = pct();
      const best = Number(localStorage.getItem(LS_BEST) || 0);

      if(score > best){
        localStorage.setItem(LS_BEST, String(score));
      }
      loadStats();

      // modal
      const overlay = $("overlay");
      overlay.style.display = "flex";

      // faces + mensagens por faixa
      let face = "üòê";
      let title = `${player}, voc√™ terminou!`;
      let msg = MOTIVATIONS[Math.floor(Math.random()*MOTIVATIONS.length)];

      if(score === 100){
        face = "ü§©";
        title = "100%!! Voc√™ virou Carbono Ninja ‚öõÔ∏èüî•";
        msg = "Perfeito! Agora sua miss√£o √© ensinar algu√©m: conhecimento bom √© conhecimento compartilhado.";
        startConfetti(1400);
      }else if(score >= 70){
        face = "ü•≥";
        title = "Mandou bem demais! üåç‚ú®";
        msg = "Voc√™ j√° entende o essencial: gases, fontes e ciclo. Bora bater seu pr√≥prio recorde?";
        startConfetti(900);
      }else if(score >= 40){
        face = "üôÇ";
        title = "T√° no caminho certo!";
        msg = "Voc√™ acertou bastante coisa. Fa√ßa mais uma rodada: repetir fixa o aprendizado.";
        stopConfetti();
      }else{
        face = "üòñ";
        title = "Opa‚Ä¶ hoje foi duro üòÖ";
        msg = "Mas √≥: isso √© treino. Erro √© pista do que estudar. Joga de novo e melhora 10%!";
        stopConfetti();
      }

      $("face").textContent = face;
      $("finalTitle").textContent = title;
      $("finalMsg").textContent = msg;
      $("finalBadge").textContent = `üèÅ ${score}% ‚Ä¢ Acertos: ${correct} ‚Ä¢ Erros: ${wrong}`;

      // tag
      $("finalTag").textContent = score >= 70 ? "Festa do Carbono üéâ" : "Treino do Carbono üí™";
    }

    function resetSession(){
      $("screenQuiz").classList.add("hidden");
      $("screenStart").classList.remove("hidden");
      $("toast").style.display = "none";
      stopConfetti();
      idx = 0; correct = 0; wrong = 0; answered = 0;
      $("liveScore").textContent = "0%";
      $("hits").textContent = "0 / 0";
      $("bar").style.width = "0%";
      setCoachText("Carbono n√£o √© vil√£o por si s√≥: o problema √© o excesso de CO‚ÇÇ/CH‚ÇÑ vindo de combust√≠veis f√≥sseis, desmatamento e mudan√ßas no uso do solo.");
    }

    function startGame(){
      const raw = $("playerName").value.trim();
      player = raw ? raw : "Visitante";
      $("hello").textContent = `üë§ ${player}`;

      // prepara lista
      qList = shuffle(QUESTION_PACK);

      idx = 0; correct = 0; wrong = 0; answered = 0;

      $("screenStart").classList.add("hidden");
      $("screenQuiz").classList.remove("hidden");
      $("toast").style.display = "none";
      $("bar").style.width = "0%";

      saveTry();
      renderQuestion();
    }

    /******************************************************************
     * 4) CONFETTI (canvas simples)
     ******************************************************************/
    const conf = {
      running:false,
      t0:0,
      duration:0,
      parts:[]
    };

    function startConfetti(ms){
      const c = $("confetti");
      const ctx = c.getContext("2d");
      const modal = c.parentElement;

      function resize(){
        c.width = modal.clientWidth * devicePixelRatio;
        c.height = modal.clientHeight * devicePixelRatio;
      }
      resize();
      window.addEventListener("resize", resize, { passive:true });

      conf.running = true;
      conf.t0 = performance.now();
      conf.duration = ms || 900;
      conf.parts = Array.from({length: 120}, () => ({
        x: Math.random()*c.width,
        y: -Math.random()*c.height*0.2,
        r: 2 + Math.random()*4,
        vy: 2 + Math.random()*6,
        vx: -2 + Math.random()*4,
        a: Math.random()*Math.PI*2,
        va: -0.15 + Math.random()*0.3
      }));

      (function tick(t){
        if(!conf.running) return;
        const elapsed = t - conf.t0;
        ctx.clearRect(0,0,c.width,c.height);

        conf.parts.forEach((p, i) => {
          p.x += p.vx;
          p.y += p.vy;
          p.a += p.va;

          // cores variadas (bem colorido)
          const hue = (i*7 + elapsed*0.08) % 360;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.a);
          ctx.fillStyle = `hsla(${hue}, 95%, 65%, .95)`;
          ctx.fillRect(-p.r, -p.r, p.r*2.2, p.r*1.6);
          ctx.restore();

          if(p.y > c.height + 20){
            p.y = -20;
            p.x = Math.random()*c.width;
          }
        });

        if(elapsed < conf.duration){
          requestAnimationFrame(tick);
        }else{
          // mant√©m s√≥ um pouquinho e para
          setTimeout(stopConfetti, 220);
        }
      })(performance.now());
    }

    function stopConfetti(){
      conf.running = false;
      const c = $("confetti");
      const ctx = c.getContext("2d");
      ctx.clearRect(0,0,c.width,c.height);
    }

    /******************************************************************
     * 5) EVENTOS
     ******************************************************************/
    $("btnStart").addEventListener("click", startGame);
    $("playerName").addEventListener("keydown", (e)=>{ if(e.key==="Enter") startGame(); });

    $("btnSkip").addEventListener("click", skip);
    $("btnFinish").addEventListener("click", finish);

    $("btnReset").addEventListener("click", resetSession);

    $("btnClose").addEventListener("click", ()=>{
      $("overlay").style.display = "none";
      stopConfetti();
    });

    $("btnPlayAgain").addEventListener("click", ()=>{
      $("overlay").style.display = "none";
      stopConfetti();
      // volta pro quiz com novas perguntas embaralhadas
      qList = shuffle(QUESTION_PACK);
      idx = 0; correct = 0; wrong = 0; answered = 0;
      $("bar").style.width = "0%";
      saveTry();
      renderQuestion();
      $("screenStart").classList.add("hidden");
      $("screenQuiz").classList.remove("hidden");
    });

    // inicializa stats
    loadStats();
  </script>
</body>
</html>
